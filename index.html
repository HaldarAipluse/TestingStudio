<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QR Scanner</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap');
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
body{
  background:#0B85FF;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  overflow-x:hidden;
  color:#fff;
}

/* Glassmorphism containers */
.container,.scanner-wrapper,.modal{
  display:none;
  background:rgba(255,255,255,0.15);
  border-radius:16px;
  padding:30px;
  width:360px;
  max-width:95%;
  text-align:center;
  box-shadow:0 8px 25px rgba(0,0,0,0.25);
  backdrop-filter:blur(12px);
  -webkit-backdrop-filter:blur(12px);
  border:1px solid rgba(255,255,255,0.3);
  animation:fadeIn .6s ease forwards;
  position:relative;
}
h2{margin-bottom:20px;color:#fff;}
input,textarea{
  width:100%;
  padding:12px;
  margin:10px 0;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.3);
  background:rgba(255,255,255,0.2);
  color:#fff;
  font-size:15px;
  outline:none;
}
input::placeholder,textarea::placeholder{color:rgba(255,255,255,0.7);}
button{
  width:100%;
  padding:12px;
  margin-top:15px;
  border:none;
  border-radius:8px;
  background:rgba(11,133,255,0.7);
  color:#fff;
  font-weight:600;
  font-size:15px;
  cursor:pointer;
  border:1px solid rgba(255,255,255,0.3);
  backdrop-filter:blur(10px);
  transition:.3s;
}
button:hover{background:rgba(11,133,255,0.9);transform:scale(1.03);}
p{margin-top:15px;font-size:14px;color:#fff;}
a{color:#fff;cursor:pointer;text-decoration:none;font-weight:500;}
a:hover{text-decoration:underline;}
.error{margin-top:10px;font-size:13px;color:#ffbaba;}
.success{margin-top:10px;font-size:13px;color:#b2ffb2;}

/* Upload Box */
.upload-box{
  width:100%;
  border:2px dashed rgba(255,255,255,0.4);
  border-radius:14px;
  padding:25px;
  text-align:center;
  transition:.3s;
  background:rgba(255,255,255,0.1);
  cursor:pointer;
  backdrop-filter:blur(8px);
}
.upload-box:hover{background:rgba(255,255,255,0.15);transform:scale(1.02);}
.upload-area i{font-size:60px;color:#fff;margin-bottom:10px;}
.upload-area p{font-size:14px;color:#fff;margin-bottom:10px;}
.upload-area img{
  display:none;
  max-width:200px;
  border-radius:10px;
  margin-top:15px;
  box-shadow:0 4px 10px rgba(0,0,0,0.1);
  animation:fadeIn .5s ease forwards;
}
.upload-box.active img{display:block;}

/* Details */
.details{margin-top:20px;display:flex;flex-direction:column;align-items:center;opacity:0;transition:.4s;width:100%;}
.details.active{opacity:1;}
.details textarea{height:150px;resize:none;}
.details .buttons{display:flex;justify-content:space-between;width:100%;margin-top:15px;}
.buttons button{width:48%;height:45px;border-radius:8px;font-size:14px;font-weight:600;}

/* Overlay + Modal */
.overlay{
  display:none;
  position:fixed;
  top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.5);
  z-index:90;
}
.modal{
  position:fixed;
  top:50%;left:50%;
  transform:translate(-50%,-50%) scale(.9);
  width:380px;max-width:95%;
  z-index:100;
  animation:popup .3s ease forwards;
}
.modal h2{color:#fff;font-size:20px;margin-bottom:10px;}
.close-modal{position:absolute;top:10px;right:15px;font-size:20px;color:#fff;cursor:pointer;}

/* Stepper */
.steps{margin-top:20px;text-align:left;}
.step{display:flex;align-items:center;margin-bottom:12px;opacity:.3;transition:.4s;}
.step span{
  width:28px;height:28px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  background:rgba(255,255,255,0.2);color:#fff;
  font-weight:600;margin-right:10px;
}
.step.active{opacity:1;transform:translateX(5px);}
.step.active span{background:#0B85FF;color:#fff;}
.step p{margin:0;font-size:14px;color:#fff;}

/* Animations */
@keyframes fadeIn{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
@keyframes popup{from{opacity:0;transform:translate(-50%,-50%) scale(.8);}to{opacity:1;transform:translate(-50%,-50%) scale(1);}}
@media(max-width:450px){
  .scanner-wrapper{width:95%;}
  .upload-area img{max-width:150px;}
  .details textarea{height:120px;}
}
</style>
</head>
<body>

<!-- Login -->
<div class="container" id="login-container">
  <h2>Login</h2>
  <input type="email" id="login-email" placeholder="Email">
  <input type="password" id="login-password" placeholder="Password">
  <button id="login-btn">Login</button>
  <div class="error" id="login-error"></div>
  <p><a id="show-forgot">Forgot Password?</a></p>
  <p>Don't have an account? <a id="show-register">Register</a></p>
</div>

<!-- Register -->
<div class="container" id="register-container">
  <h2>Register</h2>
  <input type="email" id="register-email" placeholder="Email">
  <input type="password" id="register-password" placeholder="Password">
  <button id="register-btn">Register</button>
  <div class="error" id="register-error"></div>
  <p>Already have an account? <a id="show-login">Login</a></p>
</div>

<!-- QR Scanner -->
<div class="scanner-wrapper" id="scanner-wrapper">
  <form id="upload-form" class="upload-box">
    <div class="upload-area">
      <i class="fas fa-cloud-upload-alt"></i>
      <p>Click or Drop QR Code Image</p>
      <img id="qr-image" src="#" alt="QR Preview">
    </div>
    <input type="file" id="file-input" hidden>
  </form>
  <div class="details" id="details">
    <textarea id="qr-result" disabled></textarea>
    <div class="buttons">
      <button class="close">Clear</button>
      <button class="copy">Copy</button>
    </div>
  </div>
</div>

<!-- Forgot Password Modal -->
<div class="overlay" id="forgot-overlay"></div>
<div class="modal" id="forgot-modal">
  <span class="close-modal" id="close-forgot">&times;</span>
  <h2>Reset Password</h2>
  <p style="font-size:13px;color:#fff;">Enter your email and weâ€™ll send you a reset link.</p>
  <input type="email" id="reset-email" placeholder="Your email">
  <button id="reset-btn">Send Reset Link</button>
</div>

<!-- Register Verification Modal -->
<div class="overlay" id="verify-overlay"></div>
<div class="modal" id="verify-modal">
  <span class="close-modal" id="close-verify">&times;</span>
  <h2>Email Verification</h2>
  <div class="steps" id="verify-steps">
    <div class="step"><span>1</span><p>Verification email sent</p></div>
    <div class="step"><span>2</span><p>Open your inbox (check spam)</p></div>
    <div class="step"><span>3</span><p>Click the link to verify</p></div>
    <div class="step"><span>4</span><p>Return here & login</p></div>
  </div>
</div>

<!-- Reset Instructions Modal -->
<div class="overlay" id="reset-overlay"></div>
<div class="modal" id="reset-modal">
  <span class="close-modal" id="close-reset">&times;</span>
  <h2>Password Reset</h2>
  <div class="steps" id="reset-steps">
    <div class="step"><span>1</span><p>Reset email sent</p></div>
    <div class="step"><span>2</span><p>Check your inbox (and spam)</p></div>
    <div class="step"><span>3</span><p>Click the reset link</p></div>
    <div class="step"><span>4</span><p>Set new password & login</p></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, sendPasswordResetEmail, sendEmailVerification, setPersistence, browserSessionPersistence } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

// Firebase Config
const firebaseConfig={apiKey:"AIzaSyBF8WGFStX62SCFqhMzqcvIFI0LZTJfd30",authDomain:"social-media-420.firebaseapp.com",projectId:"social-media-420",storageBucket:"social-media-420.firebasestorage.app",messagingSenderId:"137093270524",appId:"1:137093270524:web:2847379ede160b6c73c079"};
const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
setPersistence(auth,browserSessionPersistence);

// Elements
const loginContainer=document.getElementById("login-container");
const registerContainer=document.getElementById("register-container");
const scannerWrapper=document.getElementById("scanner-wrapper");
const loginEmail=document.getElementById("login-email");
const loginPassword=document.getElementById("login-password");
const loginBtn=document.getElementById("login-btn");
const loginError=document.getElementById("login-error");
const registerEmail=document.getElementById("register-email");
const registerPassword=document.getElementById("register-password");
const registerBtn=document.getElementById("register-btn");
const registerError=document.getElementById("register-error");
const showRegister=document.getElementById("show-register");
const showLogin=document.getElementById("show-login");
const showForgot=document.getElementById("show-forgot");
const form=document.getElementById("upload-form");
const fileInput=document.getElementById("file-input");
const qrImage=document.getElementById("qr-image");
const qrResult=document.getElementById("qr-result");
const details=document.getElementById("details");
const closeBtn=document.querySelector(".close");
const copyBtn=document.querySelector(".copy");

// Modals
const forgotOverlay=document.getElementById("forgot-overlay");
const forgotModal=document.getElementById("forgot-modal");
const closeForgot=document.getElementById("close-forgot");
const resetEmail=document.getElementById("reset-email");
const resetBtn=document.getElementById("reset-btn");
const verifyOverlay=document.getElementById("verify-overlay");
const verifyModal=document.getElementById("verify-modal");
const closeVerify=document.getElementById("close-verify");
const resetOverlay=document.getElementById("reset-overlay");
const resetModal=document.getElementById("reset-modal");
const closeReset=document.getElementById("close-reset");

// Switch Screens
function showLoginUI(){loginContainer.style.display="block";registerContainer.style.display="none";scannerWrapper.style.display="none";}
function showRegisterUI(){loginContainer.style.display="none";registerContainer.style.display="block";scannerWrapper.style.display="none";}
function showScannerUI(){loginContainer.style.display="none";registerContainer.style.display="none";scannerWrapper.style.display="block";}
showLoginUI();
showRegister.addEventListener("click",showRegisterUI);
showLogin.addEventListener("click",showLoginUI);

// Modal open/close
showForgot.addEventListener("click",()=>{forgotOverlay.style.display="block";forgotModal.style.display="block";});
closeForgot.addEventListener("click",()=>{forgotOverlay.style.display="none";forgotModal.style.display="none";});
closeVerify.addEventListener("click",()=>{verifyOverlay.style.display="none";verifyModal.style.display="none";});
closeReset.addEventListener("click",()=>{resetOverlay.style.display="none";resetModal.style.display="none";});

// Stepper animation
function showSteps(id){
  const steps=document.querySelectorAll("#"+id+" .step");
  let i=0;
  steps.forEach(s=>s.classList.remove("active"));
  let interval=setInterval(()=>{
    if(i<steps.length){steps[i].classList.add("active");i++;}
    else clearInterval(interval);
  },1100);
}

// Auth
loginBtn.addEventListener("click",()=>{
  signInWithEmailAndPassword(auth,loginEmail.value,loginPassword.value)
    .then(()=>{loginError.innerText="";showScannerUI();})
    .catch(err=>loginError.innerText=err.message);
});
registerBtn.addEventListener("click",()=>{
  createUserWithEmailAndPassword(auth,registerEmail.value,registerPassword.value)
    .then(userCred=>{
      sendEmailVerification(userCred.user);
      verifyOverlay.style.display="block";
      verifyModal.style.display="block";
      showSteps("verify-steps");
    })
    .catch(err=>registerError.innerText=err.message);
});
resetBtn.addEventListener("click",()=>{
  if(!resetEmail.value){alert("Enter your email.");return;}
  sendPasswordResetEmail(auth,resetEmail.value)
    .then(()=>{
      forgotOverlay.style.display="none";forgotModal.style.display="none";
      resetOverlay.style.display="block";resetModal.style.display="block";
      showSteps("reset-steps");
      setTimeout(()=>{resetOverlay.style.display="none";resetModal.style.display="none";},6000);
    })
    .catch(err=>alert(err.message));
});

// QR Scan
function fetchRequest(file,formData){
  fetch("https://api.qrserver.com/v1/read-qr-code/",{method:'POST',body:formData})
    .then(res=>res.json())
    .then(result=>{
      const data=result[0]?.symbol[0]?.data;
      if(!data)return;
      qrResult.value=data;
      form.classList.add("active");
      details.classList.add("active");
    }).catch(()=>{});
}
form.addEventListener("click",()=>fileInput.click());
fileInput.addEventListener("change",e=>{
  const file=e.target.files[0];if(!file)return;
  const formData=new FormData();formData.append('file',file);
  qrImage.src=URL.createObjectURL(file);
  fetchRequest(file,formData);
});
closeBtn.addEventListener("click",()=>{details.classList.remove("active");form.classList.remove("active");qrImage.src="";qrResult.value="";});
copyBtn.addEventListener("click",()=>navigator.clipboard.writeText(qrResult.value));
</script>
</body>
</html>
