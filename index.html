<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QR Code Scanner with Firebase Auth</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

* { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif; }
body { background:#0B85FF; display:flex; justify-content:center; align-items:center; min-height:100vh; }

.container, .scanner-wrapper { display:none; background:#fff; border-radius:15px; padding:30px; width:360px; max-width:95%; text-align:center; box-shadow:0 8px 25px rgba(0,0,0,0.15); }

h2 { margin-bottom:20px; color:#0B85FF; }
input { width:100%; padding:12px; margin:10px 0; border-radius:8px; border:1px solid #ccc; outline:none; font-size:16px; }
button { width:100%; padding:12px; margin-top:15px; border:none; border-radius:8px; background:#0B85FF; color:#fff; font-weight:600; font-size:16px; cursor:pointer; transition:0.3s; }
button:hover { background:#0868c1; }
.google-btn { background:#DB4437; color:#fff; display:flex; justify-content:center; align-items:center; gap:10px; }
.google-btn:hover { background:#c13527; }
p { margin-top:15px; font-size:14px; color:#555; }
a { color:#0B85FF; cursor:pointer; text-decoration:underline; }

#error { color:red; margin-top:5px; font-size:14px; }

#logout-btn { position:absolute; top:15px; right:15px; background:#0B85FF; color:#fff; width:auto; padding:8px 12px; border-radius:6px; border:none; cursor:pointer; font-weight:600; transition:0.3s; }
#logout-btn:hover { background:#0868c1; }

form { display:flex; flex-direction:column; justify-content:center; align-items:center; cursor:pointer; margin-top:20px; }
form:hover { transform:scale(1.02); transition:0.3s; }
form img { display:none; max-width:200px; margin-bottom:15px; border-radius:10px; }
form.active img { display:block; }
form .content i { font-size:60px; color:#0B85FF; }
form .content p { margin-top:10px; font-size:16px; color:#0B85FF; font-weight:500; }

.details { margin-top:20px; display:flex; flex-direction:column; align-items:center; opacity:0; transition:0.3s; width:100%; }
.details.active { opacity:1; }
.details textarea { width:100%; height:150px; resize:none; border-radius:8px; border:1px solid #0B85FF; padding:12px; background:#0B85FF; color:#fff; font-size:16px; outline:none; }
.details .buttons { display:flex; justify-content:space-between; width:100%; margin-top:15px; }
.buttons button { width:48%; height:50px; border-radius:8px; font-weight:600; }
@media(max-width:450px){ .scanner-wrapper{width:95%;} form img{max-width:150px;} .details textarea{height:120px;} }
</style>
</head>
<body>

<!-- Login -->
<div class="container" id="login-container">
  <h2>Login</h2>
  <button class="google-btn" id="google-signin"><i class="fab fa-google"></i> Sign in with Google</button>
  <p style="margin:10px 0; font-weight:bold;">or</p>
  <input type="email" id="login-email" placeholder="Email">
  <input type="password" id="login-password" placeholder="Password">
  <button id="login-btn">Login</button>
  <p id="login-error"></p>
  <p>Don't have an account? <a id="show-register">Register</a></p>
</div>

<!-- Register -->
<div class="container" id="register-container">
  <h2>Register</h2>
  <button class="google-btn" id="google-signup"><i class="fab fa-google"></i> Sign up with Google</button>
  <p style="margin:10px 0; font-weight:bold;">or</p>
  <input type="email" id="register-email" placeholder="Email">
  <input type="password" id="register-password" placeholder="Password">
  <button id="register-btn">Register</button>
  <p id="register-error"></p>
  <p>Already have an account? <a id="show-login">Login</a></p>
</div>

<!-- QR Scanner -->
<div class="scanner-wrapper" id="scanner-wrapper">
  <button id="logout-btn">Logout</button>
  <form id="upload-form">
    <img id="qr-image" src="#" alt="QR Code">
    <div class="content">
      <i class="fas fa-cloud-upload"></i>
      <p>Click to Upload QR Code</p>
    </div>
    <input type="file" id="file-input" hidden>
  </form>
  <div class="details" id="details">
    <textarea id="qr-result" disabled spellcheck="false"></textarea>
    <div class="buttons">
      <button class="close">Close</button>
      <button class="copy">Copy</button>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyBF8WGFStX62SCFqhMzqcvIFI0LZTJfd30",
  authDomain: "social-media-420.firebaseapp.com",
  projectId: "social-media-420",
  storageBucket: "social-media-420.firebasestorage.app",
  messagingSenderId: "137093270524",
  appId: "1:137093270524:web:2847379ede160b6c73c079"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

// Elements
const loginContainer = document.getElementById("login-container");
const registerContainer = document.getElementById("register-container");
const scannerWrapper = document.getElementById("scanner-wrapper");

const loginEmail = document.getElementById("login-email");
const loginPassword = document.getElementById("login-password");
const loginBtnEl = document.getElementById("login-btn");
const loginError = document.getElementById("login-error");

const registerEmail = document.getElementById("register-email");
const registerPassword = document.getElementById("register-password");
const registerBtnEl = document.getElementById("register-btn");
const registerError = document.getElementById("register-error");

const showRegisterLink = document.getElementById("show-register");
const showLoginLink = document.getElementById("show-login");
const logoutBtn = document.getElementById("logout-btn");

const googleSignInBtn = document.getElementById("google-signin");
const googleSignUpBtn = document.getElementById("google-signup");

const form = document.getElementById("upload-form");
const fileInput = document.getElementById("file-input");
const qrImage = document.getElementById("qr-image");
const qrResult = document.getElementById("qr-result");
const details = document.getElementById("details");
const closeBtn = document.querySelector(".close");
const copyBtn = document.querySelector(".copy");
const infoText = form.querySelector(".content p");

// Show/Hide sections
function showLogin(){ loginContainer.style.display="block"; registerContainer.style.display="none"; scannerWrapper.style.display="none"; }
function showRegister(){ loginContainer.style.display="none"; registerContainer.style.display="block"; scannerWrapper.style.display="none"; }
function showScanner(){ loginContainer.style.display="none"; registerContainer.style.display="none"; scannerWrapper.style.display="block"; }

// Default
showLogin();
showRegisterLink.addEventListener("click", showRegister);
showLoginLink.addEventListener("click", showLogin);

// Firebase Email/Password Auth
loginBtnEl.addEventListener("click", ()=>{
  signInWithEmailAndPassword(auth, loginEmail.value, loginPassword.value)
    .then(()=>{ loginError.innerText=""; showScanner(); })
    .catch(err=>loginError.innerText=err.message);
});
registerBtnEl.addEventListener("click", ()=>{
  createUserWithEmailAndPassword(auth, registerEmail.value, registerPassword.value)
    .then(()=>{ registerError.innerText=""; showScanner(); })
    .catch(err=>registerError.innerText=err.message);
});

// Google Sign-In
googleSignInBtn.addEventListener("click", ()=>{
  signInWithPopup(auth, provider).then(()=>showScanner());
});
googleSignUpBtn.addEventListener("click", ()=>{
  signInWithPopup(auth, provider).then(()=>showScanner());
});

// Logout
logoutBtn.addEventListener("click", ()=>{
  signOut(auth).then(()=>{
    showLogin(); 
    details.classList.remove("active"); 
    form.classList.remove("active"); 
    qrImage.src=""; qrResult.value="";
  });
});

// QR Scanner
function fetchRequest(file, formData){
  infoText.innerText = "Scanning QR Code...";
  fetch("https://api.qrserver.com/v1/read-qr-code/", { method:'POST', body:formData })
    .then(res=>res.json())
    .then(result=>{
      const data = result[0]?.symbol[0]?.data;
      infoText.innerText = data ? "Click to Upload QR Code" : "Couldn't scan QR Code";
      if(!data) return;
      qrResult.value = data;
      qrImage.src = URL.createObjectURL(file);
      form.classList.add("active");
      details.classList.add("active");
    }).catch(()=>{ infoText.innerText="Couldn't scan QR Code"; });
}

form.addEventListener("click", ()=>fileInput.click());
fileInput.addEventListener("change", e=>{
  const file = e.target.files[0];
  if(!file) return;
  const formData = new FormData();
  formData.append('file', file);
  fetchRequest(file, formData);
});

closeBtn.addEventListener("click", ()=>{
  details.classList.remove("active");
  form.classList.remove("active");
  qrImage.src="";
  qrResult.value="";
});
copyBtn.addEventListener("click", ()=>navigator.clipboard.writeText(qrResult.value));

</script>
</body>
</html>
